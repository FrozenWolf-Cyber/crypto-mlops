executor: KubernetesExecutor

env:
  - name: AIRFLOW__CORE__DAGS_FOLDER
    value: /opt/airflow/custom_dags
  - name: PYTHONPATH
    value: /opt/airflow/dags/repo
  - name: TEST_ENV
    value: "GOKULADETHYA"
  - name: AIRFLOW__KUBERNETES_EXECUTOR__POD_TEMPLATE_FILE
    value: /opt/airflow/pod_templates/pod_template_file.yaml
    
volumeMounts:
  - name: custom-worker-shared
    mountPath: /opt/airflow/custom_persistent_shared
  - name: airflow-dags
    mountPath: /opt/airflow/custom_dags
volumes:
  - name: custom-worker-shared
    persistentVolumeClaim:
      claimName: shared-pvc
  - name: airflow-dags
    persistentVolumeClaim:
      claimName: shared-pvc-airflow


extraEnv: |
  - name: KAFKA_HOST
    valueFrom:
      fieldRef:
        fieldPath: status.hostIP
  - name: MLFLOW_TRACKING_URI
    valueFrom:
      secretKeyRef:
        name: platform-secrets
        key: MLFLOW_URI
  - name: MLFLOW_TRACKING_USERNAME
    value: "admin"
  - name: MLFLOW_TRACKING_PASSWORD
    valueFrom:
      secretKeyRef:
        name: platform-secrets
        key: MLFLOW_ADMIN_PASSWORD

extraEnvFrom: |
  - secretRef:
      name: platform-secrets


webserverSecretKeySecretName: my-webserver-secret
# Use your custom image everywhere
airflow:
  image:
    repository: frozenwolf2003/mlops-airflow
    tag: latest

  config:
    AIRFLOW__CORE__DAGS_FOLDER: /opt/airflow/dags/repo/dags/
    AIRFLOW__KUBERNETES__POD_TEMPLATE_FILE: /opt/airflow/pod_templates/pod_template_file.yaml
  env:
    - name: PYTHONPATH
      value: /opt/airflow/dags/repo


# DAGs persistence + git-sync
dags:
  # gitSync:
  #   enabled: true
  #   repo: "https://github.com/FrozenWolf-Cyber/crypto-mlops"
  #   branch: "master"
  #   wait: 10
  persistence:
    enabled: true
    existingClaim: shared-pvc-airflow
    accessMode: ReadWriteMany

# Disable flower/redis (not needed with K8sExecutor)
flower:
  enabled: false

redis: 
  enabled: false

metrics:
  enabled: true
  statsd:
    enabled: true
    host: airflow-statsd
    port: 9125
    prefix: airflow
